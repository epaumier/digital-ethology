---
import Layout from '../../layouts/Layout.astro';
import { getLangFromUrl, useTranslations } from '../../i18n/utils';
import { supabase } from '../../lib/supabase';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

export function getStaticPaths() {
  return [
    { params: { lang: 'en' } },
    { params: { lang: 'fr' } },
  ];
}

// Check if user is authenticated
const { data: { session } } = await supabase.auth.getSession();

if (!session) {
  return Astro.redirect('/en/team');
}
---

<Layout title="Dashboard">
  <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
    <div class="px-4 py-6 sm:px-0">
      <div class="border-4 border-dashed border-gray-200 rounded-lg p-8">
        <h1 class="text-2xl font-semibold mb-4">Welcome to your Dashboard</h1>
        <p class="text-gray-600 mb-4">You are logged in as: {session.user.email}</p>
        <button
          id="logout-button"
          class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"
        >
          Sign Out
        </button>
      </div>
    </div>
  </div>
</Layout>

<script>
  import { supabase } from '../../lib/supabase';

  const logoutButton = document.getElementById('logout-button');

  logoutButton?.addEventListener('click', async () => {
    await supabase.auth.signOut();
    window.location.href = '/auth';
  });
</script>